<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ночь в городе</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #1e272e;
            color: white;
            padding: 15px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            width: 100%;
            overflow-x: hidden; /* Предотвращает горизонтальную прокрутку в контейнере */
        }

        h1 {
            margin-bottom: 20px;
            color: #f5f6fa;
            font-size: 28px;
        }

        .game-info {
            margin-bottom: 5px;
            font-size: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .timer {
            font-size: 24px;
            font-weight: bold;
            color: #f39c12;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 5px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .player-card {
            position: relative;
            width: 90%;
            margin: 0 auto 30px;
            perspective: 1000px;
            height: 400px;
            transform-style: preserve-3d;
            z-index: 1; /* Обеспечивает правильное позиционирование в 3D пространстве */
        }


        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            /* Добавьте фиксированную ширину для предотвращения изменения размеров */
            will-change: transform; /* Подсказка браузеру для оптимизации анимации */
        }

        .card-inner.flipped {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            /* Важно: добавляем left/top/right/bottom для фиксации позиции */
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .card-front {
            background: radial-gradient(circle, #3498db 0%, #2980b9 100%);
        }

        .card-back {
            transform: rotateY(180deg);
        }

        .card-back.red {
            background: radial-gradient(circle, #9a1d1f 0%, #781618 100%);
        }

        .card-back.sher {
            background: radial-gradient(circle, #ebc667 0%, #d1a94d 100%);
        }

        .card-back.black {
            background: radial-gradient(circle, #0d0d0d 0%, #000000 100%);
        }

        .card-back.don {
            background: radial-gradient(circle, #dcdcdc 0%, #b0b0b0 100%);
        }

        .card-icon {
            width: 120px;
            height: 120px;
            margin-bottom: 20px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card-icon.red {
            background-image: url("../static/icon/heart.png");
        }

        .card-icon.sher {
            background-image: url("../static/icon/loupe.png");
        }

        .card-icon.black {
            background-image: url("../static/icon/gun.png");
        }

        .card-icon.don {
            background-image: url("../static/icon/hat.png");
        }

        .front-icon {
            font-size: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .role-name {
            font-size: 36px;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.6);
        }

        .player-number {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            color: #333;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            max-width: 200px;
            padding: 15px;
            background-color: #2980b9;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .btn:hover {
            background-color: #3498db;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background-color: #7f8c8d;
            cursor: default;
            transform: none;
            opacity: 0.7;
        }

        .btn.primary {
            background-color: #27ae60;
        }

        .btn.primary:hover:not(:disabled) {
            background-color: #2ecc71;
        }

        .btn.navigation {
            background-color: #2980b9;
        }

        .btn.navigation:hover:not(:disabled) {
            background-color: #3498db;
        }

        .btn.reset {
            background-color: #d35400;
        }

        .btn.reset:hover {
            background-color: #e67e22;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: #34495e;
            border-radius: 6px;
            margin: 5px 0 20px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background-color: #2ecc71;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Адаптивность для мобильных устройств */
        @media screen and (max-width: 768px) {
            .player-card {
                height: 650px;
            }

            .card-icon {
                width: 100px;
                height: 100px;
            }

            .role-name {
                font-size: 30px;
            }

            .timer {
                font-size: 20px;
            }
        }

        @media screen and (max-width: 480px) {
            .player-card {
                height: 500px;
                width: 95%;
            }

            .card-icon {
                width: 80px;
                height: 80px;
            }

            .role-name {
                font-size: 24px;
            }

            h1 {
                font-size: 22px;
            }

            .timer {
                font-size: 18px;
            }

            .btn {
                padding: 12px;
                font-size: 14px;
            }

            .controls {
                flex-wrap: wrap;
            }

            .btn {
                flex: 1 1 40%;
                min-width: 120px;
            }

            .game-info {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Ночь в городе</h1>

    <div class="game-info">
        <p>Игрок <span id="current-player">1</span> из 10</p>
    </div>

    <div class="timer" id="timer">00:00</div>

    <div class="progress-bar">
        <div class="progress" id="progress"></div>
    </div>

    <div class="player-card">
        <div class="card-inner" id="card">
            <div class="card-front">
                <div class="player-number" id="player-number">1</div>
                <div class="card-icon front-icon">❓</div>
                <div class="role-name">Нажмите, чтобы увидеть роль</div>
            </div>
            <div class="card-back" id="card-back">
                <div class="player-number" id="player-number-back">1</div>
                <div class="card-icon" id="role-icon"></div>
                <div class="role-name" id="role-name">Мирный житель</div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="btn navigation" id="prev-btn" disabled>← Предыдущий</button>
        <button class="btn primary" id="show-btn">Разбудить игрока</button>
        <button class="btn navigation" id="next-btn" disabled>Следующий →</button>
    </div>

    <div class="controls" style="margin-top: 10px;">
        <button class="btn reset" id="reset-btn">Перемешать роли</button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Элементы DOM
        const card = document.getElementById('card');
        const cardBack = document.getElementById('card-back');
        const roleIcon = document.getElementById('role-icon');
        const roleName = document.getElementById('role-name');
        const playerNumber = document.getElementById('player-number');
        const playerNumberBack = document.getElementById('player-number-back');
        const currentPlayerText = document.getElementById('current-player');
        const progressBar = document.getElementById('progress');
        const showBtn = document.getElementById('show-btn');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const resetBtn = document.getElementById('reset-btn');
        const timerEl = document.getElementById('timer');

        // Состояние игры
        let players = [];
        let currentPlayerIndex = 0;
        let isCardFlipped = false;

        // Переменные для секундомера
        let timerInterval;
        let timerStart;
        let timerRunning = false;

        // Конфигурация ролей
        const roleConfig = {
            red: {
                name: 'Мирный житель',
                icon: '../static/icon/heart.png'
            },
            sher: {
                name: 'Шериф',
                icon: '../static/icon/loupe.png'
            },
            black: {
                name: 'Мафия',
                icon: '../static/icon/gun.png'
            },
            don: {
                name: 'Дон мафии',
                icon: '../static/icon/hat.png'
            }
        };

        // Инициализация игры
        function initGame() {
            // Создание и перемешивание ролей
            const roles = [
                'red', 'red', 'red', 'red', 'red', 'red',
                'sher',
                'black', 'black',
                'don'
            ];

            // Перемешивание ролей
            for (let i = roles.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [roles[i], roles[j]] = [roles[j], roles[i]];
            }

            // Создание игроков с распределенными ролями
            players = roles.map((role, index) => ({
                id: index + 1,
                role: role,
                seen: false
            }));

            // Сброс состояния игры
            currentPlayerIndex = 0;
            isCardFlipped = false;
            resetTimer();
            startTimer();
            updateUI();
        }

        // Обновление интерфейса
        function updateUI() {
            const player = players[currentPlayerIndex];

            // Обновление номера игрока
            playerNumber.textContent = player.id;
            playerNumberBack.textContent = player.id;
            currentPlayerText.textContent = player.id;

            // Обновление роли на обратной стороне карты
            cardBack.className = 'card-back';
            cardBack.classList.add(player.role);

            // Обновление иконки и текста роли
            const roleData = roleConfig[player.role];
            roleIcon.classList.remove(...Object.keys(roleConfig));
            roleIcon.classList.add(player.role);
            roleName.textContent = roleData.name;

            // Убираем флип карты, если был
            card.classList.remove('flipped');
            isCardFlipped = false;

            // Обновление прогресс-бара
            const progress = ((currentPlayerIndex + 1) / players.length) * 100;
            progressBar.style.width = `${progress}%`;

            // Обновление кнопок
            showBtn.disabled = false;
            showBtn.textContent = 'Показать роль';
            nextBtn.disabled = true;

            // Обновление кнопки Предыдущий
            prevBtn.disabled = currentPlayerIndex === 0;
        }

        // Функции для секундомера
        function startTimer() {
            if (!timerRunning) {
                timerStart = new Date().getTime();
                timerRunning = true;
                timerInterval = setInterval(updateTimer, 100);
            }
        }

        function updateTimer() {
            const now = new Date().getTime();
            const elapsed = now - timerStart;

            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);

            timerEl.textContent =
                (minutes < 10 ? '0' : '') + minutes + ':' +
                (seconds < 10 ? '0' : '') + seconds;
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerRunning = false;
            timerEl.textContent = '00:00';
        }

        // Переход к следующему игроку
        function nextPlayer() {
            if (currentPlayerIndex < players.length - 1) {
                currentPlayerIndex++;
                resetTimer();
                startTimer();
                updateUI();
            } else {
                // Все игроки просмотрены
                alert('Все игроки увидели свои роли! Игра может начинаться.');
            }
        }

        // Переход к предыдущему игроку
        function prevPlayer() {
            if (currentPlayerIndex > 0) {
                currentPlayerIndex--;
                resetTimer();
                startTimer();
                updateUI();
            }
        }

        // Обработчики событий
        showBtn.addEventListener('click', function () {
            if (!isCardFlipped) {
                // Переворачиваем карту, чтобы показать роль
                card.classList.add('flipped');
                isCardFlipped = true;

                // Отмечаем, что игрок увидел свою роль
                players[currentPlayerIndex].seen = true;

                // Активируем кнопки навигации
                nextBtn.disabled = currentPlayerIndex >= players.length - 1;
                prevBtn.disabled = currentPlayerIndex <= 0;
                showBtn.textContent = 'Спрятать роль';
            } else {
                // Переворачиваем карту обратно
                card.classList.remove('flipped');
                isCardFlipped = false;
                showBtn.textContent = 'Показать роль';
            }
        });

        nextBtn.addEventListener('click', function () {
            nextPlayer();
        });

        prevBtn.addEventListener('click', function () {
            prevPlayer();
        });

        resetBtn.addEventListener('click', function () {
            if (confirm('Вы уверены, что хотите перемешать роли и начать заново?')) {
                initGame();
            }
        });

        // Инициализация игры при загрузке страницы
        initGame();
    });
</script>
</body>
</html>
